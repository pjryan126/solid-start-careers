-- delete any data from raw.crime_stats staging table.
DELETE FROM raw.quality_of_life;

-- make existing batch records for median earnings inactive
UPDATE src.batch b
SET is_active = FALSE
FROM src.datasource d
WHERE b.datasource_id = 4;

-- add src.batch record
INSERT INTO src.batch (datasource_id, name, is_active)
VALUES
  (4, batch_name, TRUE);


-- load median earnings raw data
\copy raw.median_earnings FROM '/data/batch/median_earnings.csv' WITH DELIMITER AS ',' CSV HEADER QUOTE AS '"'

-- load median earnings raw data into src.median_earnings
INSERT INTO src.median_earnings (
  GEO_id1,
GEO_id2,
GEO_display_label,
HC01_EST_VC01,
HC01_MOE_VC01,
HC02_EST_VC01,
HC02_MOE_VC01,
HC03_EST_VC01,
HC03_MOE_VC01,
HC04_EST_VC01,
HC04_MOE_VC01,
HC05_EST_VC01,
HC05_MOE_VC01,
HC06_EST_VC01,
HC06_MOE_VC01,
HC01_EST_VC02,
HC01_MOE_VC02,
HC02_EST_VC02,
HC02_MOE_VC02,
HC03_EST_VC02,
HC03_MOE_VC02,
HC04_EST_VC02,
HC04_MOE_VC02,
HC05_EST_VC02,
HC05_MOE_VC02,
HC06_EST_VC02,
HC06_MOE_VC02,
HC01_EST_VC03,
HC01_MOE_VC03,
HC02_EST_VC03,
HC02_MOE_VC03,
HC03_EST_VC03,
HC03_MOE_VC03,
HC04_EST_VC03,
HC04_MOE_VC03,
HC05_EST_VC03,
HC05_MOE_VC03,
HC06_EST_VC03,
HC06_MOE_VC03,
HC01_EST_VC04,
HC01_MOE_VC04,
HC02_EST_VC04,
HC02_MOE_VC04,
HC03_EST_VC04,
HC03_MOE_VC04,
HC04_EST_VC04,
HC04_MOE_VC04,
HC05_EST_VC04,
HC05_MOE_VC04,
HC06_EST_VC04,
HC06_MOE_VC04,
HC01_EST_VC05,
HC01_MOE_VC05,
HC02_EST_VC05,
HC02_MOE_VC05,
HC03_EST_VC05,
HC03_MOE_VC05,
HC04_EST_VC05,
HC04_MOE_VC05,
HC05_EST_VC05,
HC05_MOE_VC05,
HC06_EST_VC05,
HC06_MOE_VC05,
HC01_EST_VC06,
HC01_MOE_VC06,
HC02_EST_VC06,
HC02_MOE_VC06,
HC03_EST_VC06,
HC03_MOE_VC06,
HC04_EST_VC06,
HC04_MOE_VC06,
HC05_EST_VC06,
HC05_MOE_VC06,
HC06_EST_VC06,
HC06_MOE_VC06,
HC01_EST_VC07,
HC01_MOE_VC07,
HC02_EST_VC07,
HC02_MOE_VC07,
HC03_EST_VC07,
HC03_MOE_VC07,
HC04_EST_VC07,
HC04_MOE_VC07,
HC05_EST_VC07,
HC05_MOE_VC07,
HC06_EST_VC07,
HC06_MOE_VC07,
HC01_EST_VC08,
HC01_MOE_VC08,
HC02_EST_VC08,
HC02_MOE_VC08,
HC03_EST_VC08,
HC03_MOE_VC08,
HC04_EST_VC08,
HC04_MOE_VC08,
HC05_EST_VC08,
HC05_MOE_VC08,
HC06_EST_VC08,
HC06_MOE_VC08,
HC01_EST_VC09,
HC01_MOE_VC09,
HC02_EST_VC09,
HC02_MOE_VC09,
HC03_EST_VC09,
HC03_MOE_VC09,
HC04_EST_VC09,
HC04_MOE_VC09,
HC05_EST_VC09,
HC05_MOE_VC09,
HC06_EST_VC09,
HC06_MOE_VC09,
HC01_EST_VC10,
HC01_MOE_VC10,
HC02_EST_VC10,
HC02_MOE_VC10,
HC03_EST_VC10,
HC03_MOE_VC10,
HC04_EST_VC10,
HC04_MOE_VC10,
HC05_EST_VC10,
HC05_MOE_VC10,
HC06_EST_VC10,
HC06_MOE_VC10,
HC01_EST_VC11,
HC01_MOE_VC11,
HC02_EST_VC11,
HC02_MOE_VC11,
HC03_EST_VC11,
HC03_MOE_VC11,
HC04_EST_VC11,
HC04_MOE_VC11,
HC05_EST_VC11,
HC05_MOE_VC11,
HC06_EST_VC11,
HC06_MOE_VC11,
HC01_EST_VC12,
HC01_MOE_VC12,
HC02_EST_VC12,
HC02_MOE_VC12,
HC03_EST_VC12,
HC03_MOE_VC12,
HC04_EST_VC12,
HC04_MOE_VC12,
HC05_EST_VC12,
HC05_MOE_VC12,
HC06_EST_VC12,
HC06_MOE_VC12,
HC01_EST_VC13,
HC01_MOE_VC13,
HC02_EST_VC13,
HC02_MOE_VC13,
HC03_EST_VC13,
HC03_MOE_VC13,
HC04_EST_VC13,
HC04_MOE_VC13,
HC05_EST_VC13,
HC05_MOE_VC13,
HC06_EST_VC13,
HC06_MOE_VC13,
HC01_EST_VC14,
HC01_MOE_VC14,
HC02_EST_VC14,
HC02_MOE_VC14,
HC03_EST_VC14,
HC03_MOE_VC14,
HC04_EST_VC14,
HC04_MOE_VC14,
HC05_EST_VC14,
HC05_MOE_VC14,
HC06_EST_VC14,
HC06_MOE_VC14,
HC01_EST_VC15,
HC01_MOE_VC15,
HC02_EST_VC15,
HC02_MOE_VC15,
HC03_EST_VC15,
HC03_MOE_VC15,
HC04_EST_VC15,
HC04_MOE_VC15,
HC05_EST_VC15,
HC05_MOE_VC15,
HC06_EST_VC15,
HC06_MOE_VC15,
HC01_EST_VC16,
HC01_MOE_VC16,
HC02_EST_VC16,
HC02_MOE_VC16,
HC03_EST_VC16,
HC03_MOE_VC16,
HC04_EST_VC16,
HC04_MOE_VC16,
HC05_EST_VC16,
HC05_MOE_VC16,
HC06_EST_VC16,
HC06_MOE_VC16,
HC01_EST_VC17,
HC01_MOE_VC17,
HC02_EST_VC17,
HC02_MOE_VC17,
HC03_EST_VC17,
HC03_MOE_VC17,
HC04_EST_VC17,
HC04_MOE_VC17,
HC05_EST_VC17,
HC05_MOE_VC17,
HC06_EST_VC17,
HC06_MOE_VC17,
HC01_EST_VC18,
HC01_MOE_VC18,
HC02_EST_VC18,
HC02_MOE_VC18,
HC03_EST_VC18,
HC03_MOE_VC18,
HC04_EST_VC18,
HC04_MOE_VC18,
HC05_EST_VC18,
HC05_MOE_VC18,
HC06_EST_VC18,
HC06_MOE_VC18,
HC01_EST_VC19,
HC01_MOE_VC19,
HC02_EST_VC19,
HC02_MOE_VC19,
HC03_EST_VC19,
HC03_MOE_VC19,
HC04_EST_VC19,
HC04_MOE_VC19,
HC05_EST_VC19,
HC05_MOE_VC19,
HC06_EST_VC19,
HC06_MOE_VC19,
HC01_EST_VC20,
HC01_MOE_VC20,
HC02_EST_VC20,
HC02_MOE_VC20,
HC03_EST_VC20,
HC03_MOE_VC20,
HC04_EST_VC20,
HC04_MOE_VC20,
HC05_EST_VC20,
HC05_MOE_VC20,
HC06_EST_VC20,
HC06_MOE_VC20,
HC01_EST_VC21,
HC01_MOE_VC21,
HC02_EST_VC21,
HC02_MOE_VC21,
HC03_EST_VC21,
HC03_MOE_VC21,
HC04_EST_VC21,
HC04_MOE_VC21,
HC05_EST_VC21,
HC05_MOE_VC21,
HC06_EST_VC21,
HC06_MOE_VC21,
HC01_EST_VC22,
HC01_MOE_VC22,
HC02_EST_VC22,
HC02_MOE_VC22,
HC03_EST_VC22,
HC03_MOE_VC22,
HC04_EST_VC22,
HC04_MOE_VC22,
HC05_EST_VC22,
HC05_MOE_VC22,
HC06_EST_VC22,
HC06_MOE_VC22,
HC01_EST_VC23,
HC01_MOE_VC23,
HC02_EST_VC23,
HC02_MOE_VC23,
HC03_EST_VC23,
HC03_MOE_VC23,
HC04_EST_VC23,
HC04_MOE_VC23,
HC05_EST_VC23,
HC05_MOE_VC23,
HC06_EST_VC23,
HC06_MOE_VC23,
HC01_EST_VC24,
HC01_MOE_VC24,
HC02_EST_VC24,
HC02_MOE_VC24,
HC03_EST_VC24,
HC03_MOE_VC24,
HC04_EST_VC24,
HC04_MOE_VC24,
HC05_EST_VC24,
HC05_MOE_VC24,
HC06_EST_VC24,
HC06_MOE_VC24,
HC01_EST_VC25,
HC01_MOE_VC25,
HC02_EST_VC25,
HC02_MOE_VC25,
HC03_EST_VC25,
HC03_MOE_VC25,
HC04_EST_VC25,
HC04_MOE_VC25,
HC05_EST_VC25,
HC05_MOE_VC25,
HC06_EST_VC25,
HC06_MOE_VC25,
HC01_EST_VC26,
HC01_MOE_VC26,
HC02_EST_VC26,
HC02_MOE_VC26,
HC03_EST_VC26,
HC03_MOE_VC26,
HC04_EST_VC26,
HC04_MOE_VC26,
HC05_EST_VC26,
HC05_MOE_VC26,
HC06_EST_VC26,
HC06_MOE_VC26,
HC01_EST_VC27,
HC01_MOE_VC27,
HC02_EST_VC27,
HC02_MOE_VC27,
HC03_EST_VC27,
HC03_MOE_VC27,
HC04_EST_VC27,
HC04_MOE_VC27,
HC05_EST_VC27,
HC05_MOE_VC27,
HC06_EST_VC27,
HC06_MOE_VC27,
HC01_EST_VC28,
HC01_MOE_VC28,
HC02_EST_VC28,
HC02_MOE_VC28,
HC03_EST_VC28,
HC03_MOE_VC28,
HC04_EST_VC28,
HC04_MOE_VC28,
HC05_EST_VC28,
HC05_MOE_VC28,
HC06_EST_VC28,
HC06_MOE_VC28,
HC01_EST_VC29,
HC01_MOE_VC29,
HC02_EST_VC29,
HC02_MOE_VC29,
HC03_EST_VC29,
HC03_MOE_VC29,
HC04_EST_VC29,
HC04_MOE_VC29,
HC05_EST_VC29,
HC05_MOE_VC29,
HC06_EST_VC29,
HC06_MOE_VC29,
HC01_EST_VC30,
HC01_MOE_VC30,
HC02_EST_VC30,
HC02_MOE_VC30,
HC03_EST_VC30,
HC03_MOE_VC30,
HC04_EST_VC30,
HC04_MOE_VC30,
HC05_EST_VC30,
HC05_MOE_VC30,
HC06_EST_VC30,
HC06_MOE_VC30,
HC01_EST_VC31,
HC01_MOE_VC31,
HC02_EST_VC31,
HC02_MOE_VC31,
HC03_EST_VC31,
HC03_MOE_VC31,
HC04_EST_VC31,
HC04_MOE_VC31,
HC05_EST_VC31,
HC05_MOE_VC31,
HC06_EST_VC31,
HC06_MOE_VC31,
HC01_EST_VC32,
HC01_MOE_VC32,
HC02_EST_VC32,
HC02_MOE_VC32,
HC03_EST_VC32,
HC03_MOE_VC32,
HC04_EST_VC32,
HC04_MOE_VC32,
HC05_EST_VC32,
HC05_MOE_VC32,
HC06_EST_VC32,
HC06_MOE_VC32,
HC01_EST_VC33,
HC01_MOE_VC33,
HC02_EST_VC33,
HC02_MOE_VC33,
HC03_EST_VC33,
HC03_MOE_VC33,
HC04_EST_VC33,
HC04_MOE_VC33,
HC05_EST_VC33,
HC05_MOE_VC33,
HC06_EST_VC33,
HC06_MOE_VC33,
HC01_EST_VC34,
HC01_MOE_VC34,
HC02_EST_VC34,
HC02_MOE_VC34,
HC03_EST_VC34,
HC03_MOE_VC34,
HC04_EST_VC34,
HC04_MOE_VC34,
HC05_EST_VC34,
HC05_MOE_VC34,
HC06_EST_VC34,
HC06_MOE_VC34,
HC01_EST_VC35,
HC01_MOE_VC35,
HC02_EST_VC35,
HC02_MOE_VC35,
HC03_EST_VC35,
HC03_MOE_VC35,
HC04_EST_VC35,
HC04_MOE_VC35,
HC05_EST_VC35,
HC05_MOE_VC35,
HC06_EST_VC35,
HC06_MOE_VC35,
HC01_EST_VC36,
HC01_MOE_VC36,
HC02_EST_VC36,
HC02_MOE_VC36,
HC03_EST_VC36,
HC03_MOE_VC36,
HC04_EST_VC36,
HC04_MOE_VC36,
HC05_EST_VC36,
HC05_MOE_VC36,
HC06_EST_VC36,
HC06_MOE_VC36,
HC01_EST_VC39,
HC01_MOE_VC39,
HC02_EST_VC39,
HC02_MOE_VC39,
HC03_EST_VC39,
HC03_MOE_VC39,
HC04_EST_VC39,
HC04_MOE_VC39,
HC05_EST_VC39,
HC05_MOE_VC39,
HC06_EST_VC39,
HC06_MOE_VC39
)
SELECT * FROM raw.median_earnings;

-- add batch_id to new records in src table
UPDATE src.median_earnings m
SET m.batch_id = b.batch_id
FROM src.batch b
WHERE m.batch_id IS NULL
  AND b.datasource_id = 4
  AND b.is_active = TRUE;

-- delete raw data from staging table
DELETE FROM raw.median_earnings;




